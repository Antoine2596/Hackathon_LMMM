Bootstrap: docker
From: ubuntu:20.04

%labels
    Maintainer YourName
    Version R-4.4.2

%post
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get upgrade -y

    apt-get install -y \
        tzdata \
        wget \
        build-essential \
        gfortran \
        libreadline-dev \
        libcurl4-openssl-dev \
        libssl-dev \
        libxml2-dev \
        libbz2-dev \
        liblzma-dev \
        libncurses5-dev \
        libxt-dev \
        libjpeg-dev \
        libpng-dev \
        libtiff5-dev \
        texinfo \
        texlive \
        texlive-fonts-extra \
        texlive-fonts-recommended \
        zlib1g-dev \
        libpcre3-dev \
        make \
        ca-certificates \
        python3 \
        python3-pip

    echo "Europe/Paris" > /etc/timezone
    ln -fs /usr/share/zoneinfo/Europe/Paris /etc/localtime
    dpkg-reconfigure -f noninteractive tzdata

    wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
    echo "deb https://cloud.r-project.org/bin/linux/ubuntu focal-cran40/" > /etc/apt/sources.list.d/r-project.list
    apt-get update -qq
    apt-get install -y --no-install-recommends r-base

    R --slave -e 'install.packages("BiocManager", repos="https://cloud.r-project.org/")'

    R --slave -e 'update.packages(ask = FALSE, repos="https://cloud.r-project.org/")'

    R --slave -e 'BiocManager::install(c("EnrichmentBrowser", "DESeq2", "edgeR"))'

    R --slave -e 'install.packages(c("readxl", "tidyverse", "ggplot2", "dplyr", "ggrepel"), repos="https://cloud.r-project.org/")'

    apt-get clean
    rm -rf /var/lib/apt/lists/*

%environment
    export PATH=/usr/local/bin:$PATH
    export R_HOME=/usr/local/lib/R

%runscript
    echo "R 4.4.2"
    exec R "$@"
